{% extends "base.html" %}

{% block title %}Painel do Bol√£o{% endblock %}

{% block content %}
<div class="container my-4">
    <div class="row">
        <div class="col-12">
            <h1 class="mb-4 text-primary">‚öΩ Bem-vindo ao Painel!</h1>
        </div>
    </div>

    <!-- Se√ß√£o de Rodada Ativa para Aposta -->
    <div class="row mb-5">
        <div class="col-12">
            <div class="card shadow-lg border-0">
                <div class="card-body p-4 bg-light">
                    
                    {% if rodada_aberta %}
                        {% set rodada_id_str = rodada_aberta._id %}
                        
                        <h3 class="card-title text-success mb-3">Rodada Aberta: {{ rodada_aberta.numero }}</h3>
                        <p class="text-muted">Fa√ßa seu palpite antes que o prazo termine!</p>
                        
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <div>
                                <i class="fas fa-clock text-info"></i> Prazo Final:
                                <span class="fw-bold">{{ rodada_aberta.data_limite_apostas | replace('T', ' ') }}</span>
                            </div>
                            
                            {% if palpites_usuario[rodada_id_str] %}
                                <span class="badge bg-success p-2">
                                    <i class="fas fa-check-circle"></i> Palpite Enviado
                                </span>
                            {% else %}
                                <span class="badge bg-warning text-dark p-2">
                                    <i class="fas fa-exclamation-triangle"></i> Pendente
                                </span>
                            {% endif %}
                        </div>

                        <!-- Bot√£o de Aposta (Protegido pela verifica√ß√£o do rodada_aberta e do _id) -->
                        {% if rodada_id_str %}
                            <a href="{{ url_for('apostar', rodada_id=rodada_id_str) }}" class="btn btn-success btn-lg w-100">
                                <i class="fas fa-edit"></i> 
                                {% if palpites_usuario[rodada_id_str] %}
                                    Editar Palpites da Rodada {{ rodada_aberta.numero }}
                                {% else %}
                                    Apostar Agora na Rodada {{ rodada_aberta.numero }}
                                {% endif %}
                            </a>
                        {% else %}
                             <p class="text-danger">Erro: N√£o foi poss√≠vel obter o ID da rodada para criar o link.</p>
                        {% endif %}
                        
                    {% else %}
                        <h3 class="card-title text-warning mb-3">Nenhuma Rodada Ativa para Apostas</h3>
                        <p class="text-muted">Aguarde o administrador criar a pr√≥xima rodada ou confira o hist√≥rico abaixo.</p>
                    {% endif %}

                </div>
            </div>
        </div>
    </div>

    <!-- Hist√≥rico de Rodadas -->
    <div class="row">
        <div class="col-12">
            <h2 class="mb-3 text-secondary">Hist√≥rico e Resultados</h2>

            {% if rodadas_disponiveis %}
                <ul class="list-group">
                    {% for rodada in rodadas_disponiveis %}
                        {% set id_rodada = rodada._id %}
                        <li class="list-group-item d-flex justify-content-between align-items-center p-3">
                            <div>
                                <strong>Rodada {{ rodada.numero }}</strong>
                                <span class="text-muted d-block small">Prazo: {{ rodada.data_limite_apostas | replace('T', ' ') }}</span>
                            </div>
                            
                            <div class="text-end">
                                {% if palpites_usuario[id_rodada] %}
                                    <span class="badge bg-primary me-2">Palpitou</span>
                                {% else %}
                                    <span class="badge bg-secondary me-2">N√£o Palpitou</span>
                                {% endif %}

                                <!-- A√ß√£o: Visualizar Palpites/Resultados -->
                                <!-- Assumindo que voc√™ ter√° uma rota 'ver_resultados' ou similar -->
                                <a href="#" class="btn btn-sm btn-outline-secondary">
                                    <i class="fas fa-eye"></i> Detalhes
                                </a>
                                
                                <!-- O BOT√ÉO DE APOSTA/EDITAR FOI REMOVIDO DAQUI
                                     PARA EVITAR REDUND√ÇNCIA E ERROS DE URL.
                                     O bot√£o principal no topo j√° cobre a rodada ativa. -->

                            </div>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p class="alert alert-info">Nenhuma rodada encontrada no sistema. O administrador precisa criar uma.</p>
            {% endif %}

        </div>
    </div>
    
    <!-- Se√ß√£o Admin (Apenas se logado como admin) -->
    {% if is_admin %}
        <div class="row mt-5">
            <div class="col-12">
                <h2 class="mb-3 text-danger">üõ†Ô∏è A√ß√µes de Administrador</h2>
                <a href="{{ url_for('criar_rodada') }}" class="btn btn-danger me-2">
                    <i class="fas fa-plus-circle"></i> Criar Nova Rodada
                </a>
                <a href="{{ url_for('gerenciar_rodadas') }}" class="btn btn-danger">
                    <i class="fas fa-cog"></i> Gerenciar Rodadas
                </a>
            </div>
        </div>
    {% endif %}

</div>
{% endblock %}
